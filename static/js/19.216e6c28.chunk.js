(this["webpackJsonpcalliope-talk"]=this["webpackJsonpcalliope-talk"]||[]).push([[19,59],{117:function(e,a,r){},185:function(e,a,r){"use strict";a.a={VALUE:"value",TREND:"trend",CATEGORIZATION:"categorization",DIFFERENCE:"difference",PROPORTION:"proportion",DISTRIBUTION:"distribution",RANK:"rank",ASSOCIATION:"association",EXTREME:"extreme",OUTLIER:"outlier"}},188:function(e,a,r){"use strict";a.a={JUXTAPOSITION:"juxtaposition",AREA_CHART:"Area Chart",VERTICAL_BAR_CHART:"Vertical Bar Chart",VERTICAL_DIFFERENCE_BAR_CHART:"Vertical Difference Bar Chart",VERTICAL_DIFFERENCE_ARROW_CHART:"Vertical Difference Arrow Chart",HORIZONTAL_BAR_CHART:"Horizontal Bar Chart",PROGRESS_BAR_CHART:"Progress Bar Chart",STACKED_BAR_CHART:"Stacked Bar Chart",ISOTYPE_BAR_CHART:"Isotype Bar Chart",PROPORTION_ISOTYPE_CHART:"Proportion Isotype Chart",COLOR_FILLING_MAP:"Color Filling Map",BUBBLE_CHART:"Bubble Chart",TEXT_CHART:"Text Chart",LINE_CHART:"Line Chart",STACKED_LINE_CHART:"Stacked Line Chart",RING_CHART:"Ring Chart",HALF_RING_CHART:"Half Ring Chart",PIE_CHART:"Pie Chart",SCATTER_PLOT:"Scatter Plot",TREE_MAP:"Treemap",BUBBLE_MAP:"Bubblemap"}},208:function(e,a,r){"use strict";a.a={NUMERICAL:"numerical",CATEGORICAL:"categorical",TEMPORAL:"temporal",GEOGRAPHICAL:"geographical"}},257:function(e,a,r){"use strict";r.d(a,"b",(function(){return i})),r.d(a,"a",(function(){return p}));var t=r(185),n=r(278),c=function(e,a,r){var t=n.a.filter((function(a){return a.fact===e}));if(a&&(t=t.filter((function(e){return e.chart===a}))),0===t.length)return[];var c=new Set;t.forEach((function(e){e.breakdownType.forEach((function(e){c.add(e)}))}));var s=Array.from(c);return r.filter((function(e){return-1!==s.indexOf(e.type)}))},s=r(139),u=function(e,a){var r,t=e,n=Object(s.a)(a);try{var c=function(){var e=r.value;t=t.filter((function(a){return a[e.field]===e.value}))};for(n.s();!(r=n.n()).done;)c()}catch(u){n.e(u)}finally{n.f()}return t},o=r(152),i=function(e){var a=!1;switch(e.type){case t.a.ASSOCIATION:2===e.measure.length&&(a=!0);break;case t.a.CATEGORIZATION:e.groupby.length&&(a=!0);break;case t.a.DIFFERENCE:e.measure.length&&e.groupby.length&&e.focus.length>=2&&(a=!0);break;case t.a.DISTRIBUTION:e.measure.length&&e.groupby.length&&(a=!0);break;case t.a.EXTREME:case t.a.OUTLIER:case t.a.PROPORTION:e.measure.length&&e.groupby.length&&e.focus.length&&(a=!0);break;case t.a.RANK:case t.a.TREND:e.measure.length&&e.groupby.length&&(a=!0);break;case t.a.VALUE:e.measure.length&&(a=!0)}return a},p=function(e,a,r){var n=Object.assign({},e);switch(e.type){case t.a.ASSOCIATION:if(n.focus=[],a&&r){var s=c(e.type,e.chart,a);0===n.groupby.length&&s.length>0&&(n.groupby=[s[0].field]);var o=a.filter((function(e){return"numerical"===e.type}));0===n.measure.length&&o.length>0&&(n.measure=[{field:o[0].field,aggregate:"count"}]),1===n.measure.length&&n.measure.push({field:"COUNT",aggregate:"count"})}break;case t.a.CATEGORIZATION:if(n.measure=[],n.focus=[],a&&r){var i=c(e.type,e.chart,a);0===n.groupby.length&&i.length>0&&(n.groupby=[i[0].field])}break;case t.a.DIFFERENCE:if(a&&r){var p=c(e.type,e.chart,a),l=h(r,e.groupby);0===n.groupby.length&&p.length>0&&(n.groupby=[p[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}]),n.focus.length||(n.focus=[{field:n.groupby[0],value:l[0]},{field:n.groupby[0],value:l[1]}])}break;case t.a.DISTRIBUTION:if(n.focus=[],a&&r){var g=c(e.type,e.chart,a);0===n.groupby.length&&g.length>0&&(n.groupby=[g[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}])}break;case t.a.EXTREME:if(a&&r){var d=c(e.type,e.chart,a);if(0===n.groupby.length&&d.length>0&&(n.groupby=[d[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}]),n.measure.length&&n.groupby.length){var m={y:{}};m.y.field=n.measure[0].field,m.y.aggregation=n.measure[0].aggregate,m.x={},m.x.field=n.groupby[0];var A=u(r,n.subspace),T=f(A,m),R=n.measure[0].field,b=T.reduce((function(e,a){return e[R]>a[R]?e:a}));n.focus.length||(n.focus=[{field:n.groupby[0],value:b[n.groupby[0]],extremeFocus:"max",extremeValue:b[n.measure[0].field]}])}}break;case t.a.OUTLIER:if(a&&r){var E=c(e.type,e.chart,a);if(0===n.groupby.length&&E.length>0&&(n.groupby=[E[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}]),n.measure.length&&n.groupby.length){var y={y:{}};y.y.field=n.measure[0].field,y.y.aggregation=n.measure[0].aggregate,y.x={},y.x.field=n.groupby[0];var O=u(r,n.subspace),C=f(O,y),I=C.sort((function(e,a){return a[y.y.field]-e[y.y.field]})).map((function(e){return e[y.x.field]})),v=C.sort((function(e,a){return a[y.y.field]-e[y.y.field]})).map((function(e){return e[y.y.field]})),L=v.length,w=parseInt(.25*(L-1)),N=parseInt(.75*(L-1)),_=.25*(L-1)-w,k=.75*(L-1)-N,H=v[w]+(v[w+1]-v[w])*_,P=v[N]+(v[N+1]-v[N])*k,G=P-1.5*(H-P),S=H+1.5*(H-P),M=[];v.forEach((function(e,a){(e>S||e<G)&&M.push(a)})),!n.focus.length&&M.length&&(n.focus=[{field:e.groupby[0],value:I[M[0]]}])}}break;case t.a.PROPORTION:if(a&&r){var B=c(e.type,e.chart,a);if(0===n.groupby.length&&B.length>0&&(n.groupby=[B[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}]),n.measure.length&&n.groupby.length){var x={y:{}};x.y.field=n.measure[0].field,x.y.aggregation=n.measure[0].aggregate,x.x={},x.x.field=n.groupby[0];var U=u(r,n.subspace),D=f(U,x),V=n.measure[0].field,F=D.reduce((function(e,a){return e[V]>a[V]?e:a}));n.focus.length||(n.focus=[{field:n.groupby[0],value:F[n.groupby[0]]}])}}break;case t.a.RANK:if(n.focus=[],a&&r){var j=c(n.type,n.chart,a);0===n.groupby.length&&j.length>0&&(n.groupby=[j[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}])}break;case t.a.TREND:if(n.focus=[],a&&r){var z=a.filter((function(e){return"temporal"===e.type})),W=z.map((function(e){return e.field}));0===z.length?n.groupby=[]:0!==n.groupby.length&&-1!==W.indexOf(n.groupby[0])||(n.groupby=[z[0].field]),0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}])}break;case t.a.VALUE:n.groupby=[],n.focus=[],a&&r&&0===n.measure.length&&(n.measure=[{field:"COUNT",aggregate:"count"}])}return n},l=function(e,a){return o.nest().key((function(e){return e[a.x.field]})).entries(e).map((function(e,r){var t=o.scan(e.values,(function(e,r){if(e[a.y.field]&&r[a.y.field])return r[a.y.field]-e[a.y.field]}));return t>=0?e.values[t]:e.values[0]}))},f=function(e,a){var r;switch(a.y.aggregation){case"sum":r=function(e,a){var r=o.nest().key((function(e){return e[a.x.field]})).entries(e),t=new Array(r.length).fill(0);return r.map((function(e,r){e.values.forEach((function(e){t[r]+=e[a.y.field]}));var n=Object.assign({},e.values[0]);return n[a.y.field]=t[r],n}))}(e,a);break;case"avg":r=function(e,a){var r=o.nest().key((function(e){return e[a.x.field]})).entries(e),t=new Array(r.length).fill(0);return r.map((function(e,r){e.values.forEach((function(e){t[r]+=e[a.y.field]}));var n=Object.assign({},e.values[0]);return n[a.y.field]=t[r]/e.values.length,n}))}(e,a);break;case"max":r=l(e,a);break;case"min":r=function(e,a){return o.nest().key((function(e){return e[a.x.field]})).entries(e).map((function(e){var r=o.scan(e.values,(function(e,r){if(e[a.y.field]&&r[a.y.field])return e[a.y.field]-r[a.y.field]}));return r>=0?e.values[r]:e.values[0]}))}(e,a);break;case"count":r=function(e,a){var r=o.nest().key((function(e){return e[a.x.field]})).entries(e),t=new Array(r.length).fill(0);return r.map((function(e,a){e.values.forEach((function(){t[a]+=1}));var r=Object.assign({},e.values[0]);return r.COUNT=t[a],r}))}(e,a);break;default:r=l(e,a)}return r},h=function(e,a){return a?Array.from(new Set(e.map((function(e){return e[a]})))):[]}},278:function(e,a,r){"use strict";r.d(a,"a",(function(){return s}));var t=r(185),n=r(188),c=r(208),s=[{fact:t.a.ASSOCIATION,chart:n.a.SCATTER_PLOT,breakdownType:[c.a.CATEGORICAL,c.a.TEMPORAL,c.a.GEOGRAPHICAL]},{fact:t.a.OUTLIER,chart:n.a.VERTICAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.TEMPORAL,c.a.GEOGRAPHICAL]},{fact:t.a.OUTLIER,chart:n.a.AREA_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.OUTLIER,chart:n.a.LINE_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.EXTREME,chart:n.a.VERTICAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.TEMPORAL,c.a.GEOGRAPHICAL]},{fact:t.a.EXTREME,chart:n.a.LINE_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.EXTREME,chart:n.a.AREA_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.PROPORTION,chart:n.a.PROGRESS_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL,c.a.TEMPORAL]},{fact:t.a.PROPORTION,chart:n.a.PIE_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL,c.a.TEMPORAL]},{fact:t.a.RANK,chart:n.a.HORIZONTAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL,c.a.TEMPORAL]},{fact:t.a.DISTRIBUTION,chart:n.a.AREA_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.DISTRIBUTION,chart:n.a.VERTICAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL]},{fact:t.a.DIFFERENCE,chart:n.a.HORIZONTAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL,c.a.TEMPORAL]},{fact:t.a.CATEGORIZATION,chart:n.a.VERTICAL_BAR_CHART,breakdownType:[c.a.CATEGORICAL,c.a.GEOGRAPHICAL]},{fact:t.a.TREND,chart:n.a.LINE_CHART,breakdownType:[c.a.TEMPORAL]},{fact:t.a.VALUE,chart:n.a.VERTICAL_BAR_CHART}]},291:function(e,a,r){"use strict";r.d(a,"b",(function(){return y})),r.d(a,"a",(function(){return C}));var t=r(201),n=r(0),c=r.n(n),s=r(188),u=r(185),o=r(208),i=[{fact:u.a.ASSOCIATION,chart:s.a.SCATTER_PLOT,breakdownType:[o.a.CATEGORICAL,o.a.TEMPORAL,o.a.GEOGRAPHICAL]},{fact:u.a.OUTLIER,chart:s.a.AREA_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.OUTLIER,chart:s.a.LINE_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.EXTREME,chart:s.a.VERTICAL_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.EXTREME,chart:s.a.LINE_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.EXTREME,chart:s.a.AREA_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.PROPORTION,chart:s.a.PROGRESS_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.PROPORTION,chart:s.a.PIE_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.RANK,chart:s.a.HORIZONTAL_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.DISTRIBUTION,chart:s.a.AREA_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.DISTRIBUTION,chart:s.a.VERTICAL_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.DIFFERENCE,chart:s.a.HORIZONTAL_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL,o.a.TEMPORAL]},{fact:u.a.CATEGORIZATION,chart:s.a.VERTICAL_BAR_CHART,breakdownType:[o.a.CATEGORICAL,o.a.GEOGRAPHICAL]},{fact:u.a.TREND,chart:s.a.LINE_CHART,breakdownType:[o.a.TEMPORAL]},{fact:u.a.VALUE,chart:s.a.VERTICAL_BAR_CHART}],p=r(278),l=function e(a,r){var t,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=r.filter((function(e){return e.field===a.groupby[0]}))[0],s=n?p.a:i;return t=s.filter((function(e){return e.fact===a.type})),c&&(t=t.filter((function(e){return-1!==e.breakdownType.indexOf(c.type)})),c.type===o.a.CATEGORICAL&&c.values&&(t=t.filter((function(e){return!e.rang||c.values.length>=e.rang[0]&&c.values.length<=e.rang[1]}))),0!==t.length||n||(t=e(a,r,!0))),t},f=r(15),h=r(16),g=r(17),d=r(18),m=r(475),A=function(e){Object(g.a)(r,e);var a=Object(d.a)(r);function r(){return Object(f.a)(this,r),a.apply(this,arguments)}return Object(h.a)(r,[{key:"componentDidMount",value:function(){var e=this.props.spec.chart.id,a=this.props.spec,r=e?"#vischart_".concat(e):"#demo-chart";this.autovis=new m.AutoVis,this.autovis=new m.AutoVis,this.autovis.container(r),this.autovis.load(a),this.autovis.generate()}},{key:"componentDidUpdate",value:function(e){var a=this.props.spec.chart.id,r=this.props.spec,t=a?"#vischart_".concat(a):"#demo-chart";this.autovis=new m.AutoVis,this.autovis=new m.AutoVis,this.autovis.container(t),this.autovis.load(r),this.autovis.generate()}},{key:"render",value:function(){if(this.props.spec.chart){var e=this.props.spec.chart,a=e.size;if("vegalite"===e.type){var r=this.props.spec.chart.width;.5*this.props.spec.chart.height,.5*r}else switch(a){case"wide":220,560;break;case"middle":200,360;break;case"small":150,235}}var t=(this.props.spec.chart?this.props.spec.chart:{id:"demo-chart"}).id;return c.a.createElement("div",{id:t?"vischart_".concat(t):"demo-chart",style:{height:"640",width:"640",display:"flex",alignItems:"center",justifyContent:"center"}})}}]),r}(n.Component),T=r(257),R=r(183),b=r.n(R),E=function(e){return Math.round(Math.random()*(e-1))},y=function(e,a){var r=l(a,e);return 0===r.length?null:r[E(r.length)].chart},O=function(e){var a=e;switch(e){case s.a.AREA_CHART:a="areachart";break;case s.a.BUBBLE_CHART:a="bubblechart";break;case s.a.COLOR_FILLING_MAP:a="filledmap";break;case s.a.BUBBLE_MAP:a="bubblemap";break;case s.a.HALF_RING_CHART:a="donutchart";break;case s.a.HORIZONTAL_BAR_CHART:a="horizentalbarchart";break;case s.a.VERTICAL_BAR_CHART:case s.a.STACKED_BAR_CHART:case s.a.VERTICAL_DIFFERENCE_BAR_CHART:case s.a.ISOTYPE_BAR_CHART:case s.a.VERTICAL_DIFFERENCE_ARROW_CHART:a="verticalbarchart";break;case s.a.LINE_CHART:case s.a.STACKED_LINE_CHART:a="linechart";break;case s.a.PROPORTION_ISOTYPE_CHART:case s.a.PIE_CHART:a="piechart";break;case s.a.PROGRESS_BAR_CHART:a="progresschart";break;case s.a.RING_CHART:a="donutchart";break;case s.a.SCATTER_PLOT:a="scatterplot";break;case s.a.TEXT_CHART:a="textchart";break;case s.a.TREE_MAP:a="treemap"}return a},C=function(e,a,r,n,u,o){r.chart&&""!==r.chart||(r.chart=y(e.schema,r));var i=r.chart;if(i===s.a.ISOTYPE_BAR_CHART&&(r.chart=s.a.VERTICAL_BAR_CHART),!(r=Object(T.a)(r)).chart||!Object(T.b)(r))return console.log("no valid",r),null;var p=Object(t.a)({id:a,size:u,type:O(i),style:"business",duration:0,showSuggestion:!1},o),l={data:e=Object(t.a)(Object(t.a)({},e),{},{values:n}),fact:r,chart:p};return console.log("specNew",r.chart,l),c.a.createElement(A,{spec:b.a.cloneDeep(l)})}},52:function(e,a,r){"use strict";r.r(a),r.d(a,"default",(function(){return V}));var t=r(201),n=r(15),c=r(16),s=r(17),u=r(18),o=r(0),i=r.n(o),p=r(291),l=r(185),f=[{id:0,template:"The Pearson correlation between the {{measure1}} and the {{measure2}} is {{parameter}} when {{subspace}}."},{id:1,template:"When {{subspace}}, the Pearson correlation coefficient between the {{measure1}} and the {{measure2}} is {{parameter}}."},{id:2,template:"When {{subspace}}, the {{measure1}} is correlated with the {{measure2}} and the Person correlation is {{parameter}}."}],h=[{id:0,template:"When {{subspace}}, there are {{parameter}} {{groupby}}s: {{no.1}}, {{no.2}}, {{no.3}}, and {{focus}} needs to pay attention."},{id:1,template:"When {{subspace}}, the data are grouped into {{parameter}} {{groupby}}s, including {{no.1}}, {{no.2}}, {{no.3}}, among which {{focus}} needs to pay attention."},{id:2,template:"The data contain {{parameter}} {{groupby}}s when {{subspace}}, which are {{no.1}}, {{no.2}}, {{no.3}}. {{focus}} needs to pay attention."}],g=[{id:0,template:"The difference between {{focus1}} and {{focus2}} regarding to their {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:1,template:"{{focus1}} and {{focus2}}'s difference on the {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:2,template:"A comparison between {{focus1}} and {{focus2}} on their {{agg}} {{measure}} shows the difference is {{parameter}} when {{subspace}}."}],d=[{id:0,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."},{id:1,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."},{id:2,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."}],m=[{id:0,template:"Given {{subspace}}, the {{focus}} value of the {{agg}} {{measure}} is {{parameter[1]}} when the {{groupby}} is {{parameter[0]}}."},{id:1,template:"The {{focus}} {{agg}} {{measure}} value over {{groupby}}s is {{parameter[1]}} when the {{groupby}} is {{parameter[0]}} given {{subspace}}."},{id:2,template:"Among all {{groupby}}s, {{parameter[0]}} has the {{focus}} {{agg}} {{measure}} value, which is {{parameter[1]}}, when {{subspace}}."}],A=[{id:0,template:"The {{agg}} {{measure}} of {{focus}} is an outlier when compared with that of other {{groupby}}s when {{subspace}}."},{id:1,template:"{{focus}}'s {{agg}} {{measure}} is anomalously different from other {{groupby}}s' {{measure}} when {{subspace}}."},{id:2,template:"Among various {{groupby}}s, the {{agg}} {{measure}} of {{focus}} is an anomaly when {{subspace}}."}],T=[{id:0,template:"The {{focus}} accounts for {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."},{id:1,template:"The {{focus}} makes up {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."},{id:2,template:"The {{focus}}'s {{agg}} {{measure}} takes {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."}],R=[{id:0,template:"In the {{agg}} {{measure}} ranking of different {{groupby}}s,  the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}}, when {{subspace}}."},{id:1,template:"The ranking list of the {{groupby}}s ordered by their {{agg}} {{measure}} when {{subspace}}, in which the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}}."},{id:2,template:"When sorting the {{groupby}}s in order based on their {{agg}} {{measure}}, the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}} when {{subspace}}."}],b=[{id:0,template:"The trend of the {{agg}} {{measure}} over {{groupby}}s is {{parameter}} when {{subspace}} and the value of {{focus}} needs to pay attention."},{id:1,template:"The {{agg}} {{measure}} over {{groupby}}s shows a/an {{parameter}} trend when {{subspace}} and the value of {{focus}} needs to pay attention."},{id:2,template:"The {{agg}} {{measure}} over {{groupby}}s is {{parameter}} when {{subspace}} and the value of {{focus}} needs to pay attention."}],E=[{id:0,template:"The {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:1,template:"When {{subspace}}, the value of the {{agg}} {{measure}} is {{parameter}}."},{id:2,template:"The {{agg}} {{measure}} value is {{parameter}} when {{subspace}}."}],y=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=[];switch(e){case l.a.ASSOCIATION:r=f;break;case l.a.CATEGORIZATION:r=h;break;case l.a.DIFFERENCE:r=g;break;case l.a.DISTRIBUTION:r=d;break;case l.a.EXTREME:r=m;break;case l.a.OUTLIER:r=A;break;case l.a.PROPORTION:r=T;break;case l.a.RANK:r=R;break;case l.a.TREND:r=b;break;case l.a.VALUE:r=E}-1===a&&(a=Math.floor(10*Math.random())%3);var t="";try{t=r[a].template}catch(n){console.error(n),console.log("wrong id:"+a)}return t},O=r(257),C={SUM:"sum",MAX:"max",MIN:"min",AVG:"avg",COUNT:"count"},I=r(183),v=r.n(I),L=r(476),w=function(e){switch(e){case C.SUM:return"total";case C.MAX:return"maximum";case C.MIN:return"minimum";case C.AVG:return"average";case C.COUNT:return"count";case C.NONE:default:return""}},N=function(e){return"count"===e.aggregate?"":e.field.toLowerCase()},_=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",r=e[0];if("single"===a)return r.toLowerCase();if("plural"===a){if(-1===r.indexOf(" of "))return L(r,2).toLowerCase();var t=r.split(" "),n=t.indexOf("of")-1;if(n>-1){var c=L(t[n],2);return r.replace(t[n],c)}}},k=function(e){var a=0,r="",t="";(e=(e||0).toString()).indexOf(".")>0?(a=(e=e.toFixed(2)).indexOf("."),r=e.substr(a),t=e.substring(0,a)):t=e;for(var n=[],c=0,s=(t=t.split("")).length-1;s>=0;s--)c++,n.unshift(t[s]),c%3||0===s||n.unshift(",");return n.join("")+r||""},H=function(e,a){var r="";return e.subspace.length?(e.subspace.map((function(e,a){return r+="".concat(0===a?" ":" and ","the ").concat(e.field," is ").concat(e.value)})),a=a.replace("{{subspace}}",r)):a=(a=(a=(a=(a=(a=(a=a.replace(", when {{subspace}}","")).replace(" when {{subspace}}","")).replace(" in case of {{subspace}}","")).replace(" given {{subspace}}","")).replace("When {{subspace}}, ","")).replace("Given {{subspace}}, ","")).replace("In case of {{subspace}}, ",""),a},P=function(e,a){if(-1===e.indexOf(a))return e;var r=e.indexOf(a)+a.length;"s"===e.substring(r,r+1)&&(r+=1);var t=e.indexOf(a),n=e.substring(0,r)+"</i></span>"+e.substring(r);return n=n.substring(0,t)+'<span class="hightlight"><i>'+n.substring(t)},G=function(e){if(!Object(O.b)(e))return"";var a,r,t=e.generatedScript;switch(t=P(e.generatedScript,e.type),e.breakdown&&e.breakdown[0]&&(t=P(t,e.breakdown[0].field)),e.measure&&e.measure[0]&&(t=P(t,e.measure[0].field)),e.subspace&&e.subspace[0]&&(t=P(t,e.subspace[0].field)),e.type){case l.a.ASSOCIATION:r=t;break;case l.a.RANK:var n=e.parameter[0],c=e.parameter[1],s=e.parameter[2];r=P(t,n),c&&(r=P(r,c)),c&&s&&(r=P(r,s));break;case l.a.VALUE:case l.a.DIFFERENCE:r=P(t,e.measure[0].field.toLowerCase());break;case l.a.OUTLIER:case l.a.DISTRIBUTION:r=t;break;case l.a.CATEGORIZATION:a=e.parameter.length.toString(),r=P(t,a);break;default:a=e.parameter,r=P(t,a)}return r},S=r(152),M=(r(117),"200"),B="150",x=new Map,U=new Map,D=null,V=function(e){Object(s.a)(r,e);var a=Object(u.a)(r);function r(e){var c;return Object(n.a)(this,r),(c=a.call(this,e)).layoutNode=i.a.createRef(),c.onResize=function(){window.addEventListener("resize",(function(){setTimeout((function(){c.updateTreeMapLayout()}),300)}))},c.updateTreeMapLayout=function(){if(c.layoutNode.current){var e=c.layoutNode.current,a=e.clientWidth,r=e.clientHeight,t=c.props.QAID,n=c.TreemapSize[t],s=n.preWidth,u=n.preHeight;(0!==a&&s!==a||u!==r&&0!==r)&&(c.forceUpdate(),c.updateTreemapSize(t,a,r))}c.batchUpdateVis(),c.svgTransformer()},c.updateTreemapSize=function(e,a,r){c.TreemapSize[e].preWidth=a,c.TreemapSize[e].preHeight=r},c.batchUpdateVis=function(){c.props.facts.map((function(e,a){if(!x.get(e.id)||!U.get(e.id))return e;var r=x.get(e.id).current,t=U.get(e.id).current,n=0,s=0,u=0;if(t&&(u=t.clientHeight),D&&D[a]){var o=D[a],i=o.x0,p=o.x1,l=o.y0;n=p-i,s=o.y1-l-u}return 0===n||0===s||(r&&c.svgTransformer(r,n,s),c.updateAVis(e,n,s,u)),e}))},c.svgTransformer=function(e,a,r){if(e){var t=Math.min(a,r)/640,n=e.children&&e.children[0];n&&(n.setAttribute("style","transform:scale(".concat(.9*t,")")),n.onmouseenter=function(){var e=c.props.isEdit;n.setAttribute("style","transform:scale(".concat(.9*t,");border:").concat(e?"1px dashed grey":""))},n.onmouseleave=function(){n.setAttribute("style","transform:scale(".concat(.9*t,")"))})}},c._isValidate=function(e,a){return!(e&&e<M||a&&a<B)},c._renderedFacts=function(e){var a=c.state,r=a.renderNum,t=a.count;return e.slice(0,r>=t?t:r)},c.updateAVis=function(e,a,r,t){var n=e.width,s=e.height,u=e.captionH;if(n!==a||s!==r||u!==t){var o=c.props.facts,i=o[o.findIndex((function(a){return a.id===e.id}))];i.width=a,i.height=r,i.captionH=t,c.setState({facts:o})}},c.weightAdapter=function(e,a){var r=e.children.length,n=[];switch(a){case 1:n=[1],2===r?n=[3,2]:3===r&&(n=[3,1.2,.8]);break;case 2:n=[1],2===r?n=[4,3]:3===r&&(n=[6,3,2]);break;case 3:n=[1],2===r?n=[3,2]:3===r&&(n=[3,1.2,.8]);break;case 4:n=[1],2===r?n=[3,2]:3===r&&(n=[4,3,2])}return{children:e.children.map((function(e,a){return Object(t.a)(Object(t.a)({},e),{},{significance:n[a]})}))}},c.change=function(e){c.setState({renderNum:e.target.value})},c.getTreemap=function(e,a,r){return S.treemap().tile(S.treemapResquarify.ratio(1)).size([e,a]).padding(3).round(!0)(S.hierarchy(r).sum((function(e){return e.significance})))},c.sort=function(e){return e.sort((function(e,a){return a.significance-e.significance}))},c.getSize=function(){return"large"},c.setRef=function(e){return x.set(e,i.a.createRef()),x.get(e)},c.setCaptionRef=function(e){return U.set(e,i.a.createRef()),U.get(e)},c.endEdit=function(e,a,r){var t=U.get(e).current,n=c.props.cachedQA;n[parseInt(a.id.split("QA")[0])].facts[r].script=t.innerHTML,c.props.saveCachedDecomposedQA(n)},c.deleteCard=function(e,a){var r=c.props.cachedQA,t=v.a.cloneDeep(r),n=parseInt(e.id.split("QA")[0]);t[n]&&t[n].facts.splice(a,1),t[n]&&0===t[n].facts.length&&t.splice(n,1),c.props.saveCachedDecomposedQA(t)},c.state={renderNum:5,count:5,clientWidth:0,clientHeight:0,facts:c.props.facts},c.visBox=i.a.createRef(),c.TreemapSize=new Array(c.props.columnNum).fill({preWidth:0,preHeight:0}),c}return Object(c.a)(r,[{key:"componentDidMount",value:function(){this.updateTreeMapLayout(),this.onResize()}},{key:"componentDidUpdate",value:function(){this.updateTreeMapLayout()}},{key:"render",value:function(){var e=this,a=this.props,r=a.facts,n=a.data,c=a.schema,s=a.columnNum,u=a.isEdit,o=a.QAID,f=this.TreemapSize[o]?this.TreemapSize[o]:{preWidth:0,preHeight:0},h=f.preWidth,g=f.preHeight,d={children:this._renderedFacts(this.sort(r))};D=this.getTreemap(h,g,this.weightAdapter(d,s)).leaves();var m=function(a){var r=a.index,s=a.fact,o=a.x,f=a.y,h=a.width,g=a.height,d=s.script?s.script:function(e){if(!Object(O.b)(e))return"";var a=v.a.cloneDeep(e),r=y(a.type),t=C.NONE;switch(a.measure.length>0&&(t=a.measure[0].aggregate),a.type){case l.a.ASSOCIATION:r=(r=(r=(r=r.replace("{{measure1}}",N(a.measure[0]))).replace("{{measure2}}",N(a.measure[1]))).replace("{{agg1}}",w(a.measure[0].aggregate))).replace("{{agg2}}",w(a.measure[1].aggregate)),r=H(a,r),""!==a.parameter&&(r=r.replace("{{parameter}}",k(Number.parseFloat(a.parameter).toFixed(3))));break;case l.a.CATEGORIZATION:if(r=(r=r.replace("{{groupby}}s",_(a.groupby,"plural"))).replace("{{groupby}}s",_(a.groupby,"plural")),r=H(a,r),a.parameter.length){r=r.replace("{{parameter}}",k(a.parameter.length));var n="";a.parameter.forEach((function(e,a){n+="".concat(0===a?"":","," ").concat(e)})),r=r.replace("{{no.1}}, {{no.2}}, {{no.3}}",n)}if(a.focus.length)if(r.indexOf(". {{focus}}")>-1){var c=a.focus[0].value.slice(0,1).toUpperCase()+a.focus[0].value.slice(1);r=r.replace("{{focus}}",c)}else r=r.replace("{{focus}}",a.focus[0].value);else r=(r=(r=r.replace(", and {{focus}} needs to pay attention","")).replace(", among which {{focus}} needs to pay attention","")).replace(". {{focus}} needs to pay attention","");break;case l.a.DIFFERENCE:r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t)),a.focus.length>=2&&(r=(r=r.replace("{{focus1}}",a.focus[0].value)).replace("{{focus2}}",a.focus[1].value)),r=H(a,r),""!==a.parameter&&(r=r.replace("{{parameter}}",k(a.parameter)));break;case l.a.DISTRIBUTION:r=(r=(r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t))).replace("{{groupby}}s",_(a.groupby,"plural"))).replace("{{groupby}}",_(a.groupby)),r=H(a,r),r=a.focus.length?r.replace("{{focus}}",a.focus[0].value):r.replace(" and {{focus}} needs to pay attention","");break;case l.a.EXTREME:r=(r=(r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t))).replace("{{groupby}}s",_(a.groupby,"plural"))).replace("{{groupby}}",_(a.groupby))).replace("{{groupby}}",_(a.groupby)),r=H(a,r),a.focus.length&&(void 0!==a.focus[0].extremeFocus&&void 0!==a.focus[0].extremeValue?r=(r=(r="min"===a.focus[0].extremeFocus?r.replace("{{focus}}","minimum"):r.replace("{{focus}}","maximum")).replace("{{parameter[0]}}",a.focus[0].value)).replace("{{parameter[1]}}",k(Math.round(100*a.parameter[1])/100)):a.parameter.length&&(r=(r=(r="min"===a.parameter[0]?r.replace("{{focus}}","minimum"):r.replace("{{focus}}","maximum")).replace("{{parameter[0]}}",a.focus[0].value)).replace("{{parameter[1]}}",k(a.parameter[1]))));break;case l.a.OUTLIER:r=(r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{measure}}",N(a.measure[0]))).replace("{{groupby}}s",_(a.groupby,"plural"))).replace("{{agg}}",w(t)),r=H(a,r),a.focus.length&&(r=r.replace("{{focus}}",a.focus[0].value));break;case l.a.PROPORTION:r=(r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t))).replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t)),r=H(a,r),a.focus.length&&(r=r.replace("{{focus}}",a.focus[0].value)),a.parameter&&(r=r.replace("{{parameter}}",a.parameter));break;case l.a.RANK:r=(r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t))).replace("{{groupby}}s",_(a.groupby,"plural"))).replace("{{groupby}}s",_(a.groupby,"plural")),r=H(a,r),a.parameter.length>=3?(r=(r=(r=r.replace("{{parameter}}",k(a.parameter.length))).replace("{{no.1}}",a.parameter[0])).replace("{{no.2}}",a.parameter[1]),3===a.parameter.length||a.parameter.length>3?r=r.replace("{{no.3}}",a.parameter[2]):2===a.parameter.length&&(r=r.replace(", {{no.3}}",""))):r="";break;case l.a.TREND:r=(r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t))).replace("{{groupby}}s",_(a.groupby,"plural")),r=H(a,r),a.parameter&&(r=r.replace("{{parameter}}",a.parameter),r="increasing"===a.parameter?r.replace("a/an","an"):r.replace("a/an","a")),r=a.focus.length?r.replace("{{focus}}",a.focus[0].value):r.replace(" and the value of {{focus}} needs to pay attention","");break;case l.a.VALUE:r=(r=r.replace("{{measure}}",N(a.measure[0]))).replace("{{agg}}",w(t)),r=H(a,r),a.focus.length&&(r=r.replace("{{focus}}",a.focus[0].value)),""!==a.parameter&&(r=r.replace("{{parameter}}",k(a.parameter)))}return r=r.slice(0,1).toUpperCase()+r.slice(1)}(s)||" ";return s.generatedScript=d,i.a.createElement("div",{style:{position:"absolute",left:o,top:f,width:h,height:g}},i.a.createElement("div",{className:"chart-card"},u&&i.a.createElement("div",{className:"delete",onClick:function(){return e.deleteCard(s,r)}}),i.a.createElement("div",{className:"wrapper"},i.a.createElement("div",{className:"vis-box",style:{height:"calc(100% - ".concat(s.captionH,"px)")}},i.a.createElement("div",{className:"bound-box",id:s.id,ref:e.setRef(s.id)},Object(p.a)({schema:c},s.id,s,n,e.getSize(),Object(t.a)({},{height:640,width:640})))),i.a.createElement("div",{className:"caption",contentEditable:u,suppressContentEditableWarning:!0,ref:e.setCaptionRef(s.id,r),onBlur:function(){return e.endEdit(s.id,s,r)},dangerouslySetInnerHTML:{__html:G(s)}}))))};return i.a.createElement("div",{className:"inner-auto-layout",ref:this.layoutNode},D&&D.map((function(e,a){return i.a.createElement(m,{key:a,index:a,fact:e.data,x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0})})))}}]),r}(o.Component)}}]);
//# sourceMappingURL=19.216e6c28.chunk.js.map